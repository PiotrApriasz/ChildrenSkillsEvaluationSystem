@using MudBlazor

<div class="gi-field @(IsRaised ? "gi-raised" : null)">
    <input id="@Id"
           class="gi-input @(HasError ? "gi-input-error" : null)" 
           type="@HtmlType"
           @bind-value="CurrentValue" @bind-value:event="oninput"
           placeholder=" "
           @onfocus="() => _isFocused = true"
           @onblur="() => _isFocused = false"
           aria-invalid="@HasError"
           aria-describedby="@(HasError ? $"{Id}_err" : null)"
           required="@Required" />
    
    @if (!string.IsNullOrWhiteSpace(Label))
    {
        <label for="@Id" class="gi-label">@Label</label>
    }
    
    @if (HasError && !string.IsNullOrWhiteSpace(ErrorText))
    {
        <div id="@($"{Id}_err")" class="gi-error">@ErrorText</div>
    }
</div>

@code {
    [Parameter] public string Value { get; set; } = string.Empty;
    [Parameter] public EventCallback<string> ValueChanged { get; set; }
    [Parameter] public string Label { get; set; } = string.Empty;
    [Parameter] public InputType InputType { get; set; } = InputType.Text;
    [Parameter] public bool Required { get; set; }
    [Parameter] public bool HasError { get; set; }
    [Parameter] public string? ErrorText { get; set; }

    private bool _isFocused;
    private bool IsRaised => _isFocused || !string.IsNullOrEmpty(Value);
    private string Id { get; } = $"gi_{Guid.NewGuid():N}";
    private string HtmlType => InputType switch {
        InputType.Password => "password",
        InputType.Email    => "email",
        InputType.Number   => "number",
        _ => "text"
    };
    
    private string CurrentValue
    {
        get => Value;
        set
        {
            if (Value == value) return;
            Value = value;
            _ = ValueChanged.InvokeAsync(value); 
        }
    }
}